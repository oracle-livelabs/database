{
  "paragraphs": [
    {
      "text": "%md\n# How an AI Database Builds Competence\n\n## Introduction\n\nIn this lab, you'll build the learning loop that turns agents from first-day interns into seasoned contributors.\n\nAgents don't improve automatically just by running more tasks. Without recording outcomes and retrieving relevant experience, agents repeat the same mistakes and rediscover the same edge cases. The learning loop changes this: **action → result → memory → improvement**.\n\nThe technical foundation for this loop is **semantic search**—the ability to find relevant past experiences by meaning, not just keywords.\n\nIn this lab, you'll load an ONNX embedding model, add vector columns for semantic embeddings, and build the retrieval system that makes outcome-based learning possible.\n\nEstimated Time: 15 minutes\n\n### Objectives\n\n* Load an ONNX embedding model into the database\n* Add VECTOR columns for semantic embeddings\n* Create semantic search that finds by meaning\n* Build the learning loop: action → result → memory → improvement\n* See how agents get better over time\n\n### Prerequisites\n\nThis lab assumes you have:\n\n* An AI profile named `genai` already configured\n* Oracle Database 26ai with Select AI Agent\n* Basic knowledge of SQL\n\n## Task 1: Create the Memory Table\n\nFirst, we'll create a memory table to store agent experiences.\n\n1. Create the agent memory table with a vector column for semantic embeddings.",
      "config": { "colWidth": 12.0, "enabled": true, "results": {}, "editorSetting": { "language": "md" } }
    },
    {
      "text": "%script\nCREATE TABLE agent_memory (\n    memory_id      RAW(16) DEFAULT SYS_GUID() PRIMARY KEY,\n    memory_type    VARCHAR2(20) NOT NULL,\n    session_id     VARCHAR2(100),\n    entity_id      VARCHAR2(100),\n    content        JSON NOT NULL,\n    embedding      VECTOR(384),\n    created_at     TIMESTAMP DEFAULT SYSTIMESTAMP,\n    expires_at     TIMESTAMP\n);\n\nCREATE INDEX idx_memory_type ON agent_memory(memory_type);",
      "config": { "colWidth": 12.0, "enabled": true, "results": {}, "editorSetting": { "language": "sql" } }
    },
    {
      "text": "%md\n## Task 2: Load the ONNX Embedding Model\n\nEmbedding models convert text into numerical vectors that capture meaning.\n\n1. Download the model.",
      "config": { "colWidth": 12.0, "enabled": true, "results": {}, "editorSetting": { "language": "md" } }
    },
    {
      "text": "%script\nBEGIN\n    DBMS_CLOUD.GET_OBJECT(\n        credential_name => NULL,\n        directory_name  => 'DATA_PUMP_DIR',\n        object_uri      => 'https://adwc4pm.objectstorage.us-ashburn-1.oci.customer-oci.com/' ||\n                           'p/eLddQappgBJ7jNi6Guz9m9LOtYe2u8LWY19GfgU8flFK4N9YgP4kTlrE9Px3pE12/' ||\n                           'n/adwc4pm/b/OML-Resources/o/all_MiniLM_L12_v2.onnx'\n    );\nEND;\n/",
      "config": { "colWidth": 12.0, "enabled": true, "results": {}, "editorSetting": { "language": "sql" } }
    },
    {
      "text": "%md\n2. Load it into the database.",
      "config": { "colWidth": 12.0, "enabled": true, "results": {}, "editorSetting": { "language": "md" } }
    },
    {
      "text": "%script\nBEGIN\n    DBMS_VECTOR.LOAD_ONNX_MODEL(\n        directory  => 'DATA_PUMP_DIR',\n        file_name  => 'all_MiniLM_L12_v2.onnx',\n        model_name => 'ALL_MINILM_L12_V2'\n    );\nEND;\n/",
      "config": { "colWidth": 12.0, "enabled": true, "results": {}, "editorSetting": { "language": "sql" } }
    },
    {
      "text": "%md\n3. Verify the model is loaded.",
      "config": { "colWidth": 12.0, "enabled": true, "results": {}, "editorSetting": { "language": "md" } }
    },
    {
      "text": "%script\nSELECT model_name, algorithm, mining_function \nFROM user_mining_models \nWHERE model_name = 'ALL_MINILM_L12_V2';",
      "config": { "colWidth": 12.0, "enabled": true, "results": {}, "editorSetting": { "language": "sql" } }
    },
    {
      "text": "%md\n## Task 3: Create a Vector Index\n\n1. Create a vector index for fast similarity search.",
      "config": { "colWidth": 12.0, "enabled": true, "results": {}, "editorSetting": { "language": "md" } }
    },
    {
      "text": "%script\nCREATE VECTOR INDEX idx_memory_vector ON agent_memory(embedding)\nORGANIZATION NEIGHBOR PARTITIONS\nDISTANCE COSINE\nWITH TARGET ACCURACY 95;",
      "config": { "colWidth": 12.0, "enabled": true, "results": {}, "editorSetting": { "language": "sql" } }
    },
    {
      "text": "%md\n## Task 4: Create the Learning Loop Functions\n\nThe learning loop: action → result → observe → interpret → store → retrieve → better decision.\n\n1. Create a function to store experiences with embeddings.",
      "config": { "colWidth": 12.0, "enabled": true, "results": {}, "editorSetting": { "language": "md" } }
    },
    {
      "text": "%script\nCREATE OR REPLACE FUNCTION store_experience(\n    p_situation  VARCHAR2,\n    p_action     VARCHAR2,\n    p_outcome    VARCHAR2,\n    p_success    VARCHAR2 DEFAULT 'true'\n) RETURN VARCHAR2 AS\n    PRAGMA AUTONOMOUS_TRANSACTION;\n    v_search_text VARCHAR2(1000);\nBEGIN\n    v_search_text := p_situation || ' ' || p_action || ' ' || p_outcome;\n    \n    INSERT INTO agent_memory (memory_type, content, embedding)\n    VALUES (\n        'EPISODIC',\n        JSON_OBJECT(\n            'situation'  VALUE p_situation,\n            'action'     VALUE p_action,\n            'outcome'    VALUE p_outcome,\n            'success'    VALUE (CASE WHEN UPPER(p_success) = 'TRUE' THEN true ELSE false END),\n            'recorded'   VALUE TO_CHAR(SYSTIMESTAMP, 'YYYY-MM-DD HH24:MI:SS')\n        ),\n        VECTOR_EMBEDDING(ALL_MINILM_L12_V2 USING v_search_text AS DATA)\n    );\n    COMMIT;\n    \n    RETURN 'Experience stored with semantic embedding';\nEND;\n/",
      "config": { "colWidth": 12.0, "enabled": true, "results": {}, "editorSetting": { "language": "sql" } }
    },
    {
      "text": "%md\n2. Create semantic search for similar experiences.",
      "config": { "colWidth": 12.0, "enabled": true, "results": {}, "editorSetting": { "language": "md" } }
    },
    {
      "text": "%script\nCREATE OR REPLACE FUNCTION find_relevant_experience(\n    p_situation VARCHAR2,\n    p_limit     NUMBER DEFAULT 3\n) RETURN CLOB AS\n    v_result CLOB := '';\n    v_count NUMBER := 0;\nBEGIN\n    FOR rec IN (\n        SELECT \n            m.content.situation.string() as situation,\n            m.content.action.string() as action,\n            m.content.outcome.string() as outcome,\n            m.content.success.boolean() as success,\n            ROUND(1 - VECTOR_DISTANCE(\n                embedding,\n                VECTOR_EMBEDDING(ALL_MINILM_L12_V2 USING p_situation AS DATA),\n                COSINE\n            ), 3) as relevance\n        FROM agent_memory m\n        WHERE memory_type = 'EPISODIC'\n        AND embedding IS NOT NULL\n        ORDER BY VECTOR_DISTANCE(\n            embedding,\n            VECTOR_EMBEDDING(ALL_MINILM_L12_V2 USING p_situation AS DATA),\n            COSINE\n        )\n        FETCH FIRST p_limit ROWS ONLY\n    ) LOOP\n        v_result := v_result || \n            'Situation: ' || rec.situation || CHR(10) ||\n            'Action taken: ' || rec.action || CHR(10) ||\n            'Outcome: ' || rec.outcome || \n            ' (Success: ' || CASE WHEN rec.success THEN 'Yes' ELSE 'No' END || ')' || CHR(10) ||\n            'Relevance: ' || (rec.relevance * 100) || '%' || CHR(10) || CHR(10);\n        v_count := v_count + 1;\n    END LOOP;\n    \n    IF v_count = 0 THEN\n        RETURN 'No relevant experiences found. This appears to be a new situation.';\n    END IF;\n    \n    RETURN 'Found ' || v_count || ' relevant experiences:' || CHR(10) || CHR(10) || v_result;\nEND;\n/",
      "config": { "colWidth": 12.0, "enabled": true, "results": {}, "editorSetting": { "language": "sql" } }
    },
    {
      "text": "%md\n## Task 5: Seed the Learning Database\n\nLet's add some experiences the agent can learn from.",
      "config": { "colWidth": 12.0, "enabled": true, "results": {}, "editorSetting": { "language": "md" } }
    },
    {
      "text": "%script\n-- Successful resolutions\nSELECT store_experience(\n    'Premium customer complained about shipping delay',\n    'Offered expedited shipping at no cost plus $20 credit',\n    'Customer satisfied, left positive review',\n    'true'\n) FROM DUAL;\n\nSELECT store_experience(\n    'Customer requested price match from competitor',\n    'Verified competitor price and approved 15% discount',\n    'Customer placed order immediately',\n    'true'\n) FROM DUAL;\n\nSELECT store_experience(\n    'New customer confused about product setup',\n    'Scheduled 30-minute video call for walkthrough',\n    'Customer completed setup, purchased add-on products',\n    'true'\n) FROM DUAL;\n\n-- A failure to learn from\nSELECT store_experience(\n    'Customer upset about billing error',\n    'Explained company policy without offering resolution',\n    'Customer cancelled account and posted negative review',\n    'false'\n) FROM DUAL;\n\nSELECT store_experience(\n    'Customer upset about billing error',\n    'Immediately corrected the error and applied 10% credit',\n    'Customer satisfied and upgraded their plan',\n    'true'\n) FROM DUAL;",
      "config": { "colWidth": 12.0, "enabled": true, "results": {}, "editorSetting": { "language": "sql" } }
    },
    {
      "text": "%md\n## Task 6: See Semantic Search in Action\n\nNow test finding relevant experience by meaning, not keywords.\n\n1. Search for a shipping issue (different words, same meaning).",
      "config": { "colWidth": 12.0, "enabled": true, "results": {}, "editorSetting": { "language": "md" } }
    },
    {
      "text": "%script\nSET LONG 5000\nSET LINESIZE 200\nSELECT find_relevant_experience('customer angry about late delivery') as experience FROM DUAL;",
      "config": { "colWidth": 12.0, "enabled": true, "results": {}, "editorSetting": { "language": "sql" } }
    },
    {
      "text": "%md\n**Observe:** Finds \"shipping delay\" experience even though we said \"late delivery.\"\n\n2. Search for a pricing situation.",
      "config": { "colWidth": 12.0, "enabled": true, "results": {}, "editorSetting": { "language": "md" } }
    },
    {
      "text": "%script\nSELECT find_relevant_experience('customer wants us to match Amazon price') as experience FROM DUAL;",
      "config": { "colWidth": 12.0, "enabled": true, "results": {}, "editorSetting": { "language": "sql" } }
    },
    {
      "text": "%md\n**Observe:** Finds the price match experience.\n\n3. Search for a billing problem.",
      "config": { "colWidth": 12.0, "enabled": true, "results": {}, "editorSetting": { "language": "md" } }
    },
    {
      "text": "%script\nSELECT find_relevant_experience('customer has billing complaint') as experience FROM DUAL;",
      "config": { "colWidth": 12.0, "enabled": true, "results": {}, "editorSetting": { "language": "sql" } }
    },
    {
      "text": "%md\n**Observe:** Finds BOTH billing experiences—one that failed and one that succeeded. The agent can learn from both.\n\n## Task 7: See the Learning Loop in Action\n\nLet's trace a complete learning loop.\n\n1. **New situation arrives.**",
      "config": { "colWidth": 12.0, "enabled": true, "results": {}, "editorSetting": { "language": "md" } }
    },
    {
      "text": "%script\n-- Agent receives: \"Customer TechCorp is upset about incorrect invoice\"\nSELECT find_relevant_experience('Customer upset about incorrect invoice') as past_experience FROM DUAL;",
      "config": { "colWidth": 12.0, "enabled": true, "results": {}, "editorSetting": { "language": "sql" } }
    },
    {
      "text": "%md\n2. **Agent sees what worked before** (billing error → immediate correction + credit → success).\n\n3. **Agent takes informed action** (applies the successful pattern).\n\n4. **Outcome is recorded.**",
      "config": { "colWidth": 12.0, "enabled": true, "results": {}, "editorSetting": { "language": "md" } }
    },
    {
      "text": "%script\nSELECT store_experience(\n    'Customer TechCorp upset about incorrect invoice',\n    'Immediately corrected invoice and applied 10% credit as goodwill',\n    'Customer thanked us and confirmed continued partnership',\n    'true'\n) FROM DUAL;",
      "config": { "colWidth": 12.0, "enabled": true, "results": {}, "editorSetting": { "language": "sql" } }
    },
    {
      "text": "%md\n5. **Next time, even more experience to draw from.**",
      "config": { "colWidth": 12.0, "enabled": true, "results": {}, "editorSetting": { "language": "md" } }
    },
    {
      "text": "%script\nSELECT find_relevant_experience('invoice problem') as growing_experience FROM DUAL;",
      "config": { "colWidth": 12.0, "enabled": true, "results": {}, "editorSetting": { "language": "sql" } }
    },
    {
      "text": "%md\n## Task 8: View the Competence Building",
      "config": { "colWidth": 12.0, "enabled": true, "results": {}, "editorSetting": { "language": "md" } }
    },
    {
      "text": "%script\nSELECT \n    m.content.situation.string() as situation,\n    m.content.success.boolean() as success,\n    created_at\nFROM agent_memory m\nWHERE memory_type = 'EPISODIC'\nORDER BY created_at DESC;",
      "config": { "colWidth": 12.0, "enabled": true, "results": {}, "editorSetting": { "language": "sql" } }
    },
    {
      "text": "%md\n## Summary\n\nIn this lab, you built the learning loop:\n\n* Loaded an ONNX embedding model into the database\n* Added VECTOR column for semantic embeddings\n* Created semantic search that finds by meaning\n* Stored experiences that teach the agent\n* Saw how agents retrieve relevant experience to decide\n\n**Key takeaway:** This is how agents improve—not magically, but systematically. Action → result → memory → improvement. The AI database powers it all.\n\n## Cleanup (Optional)",
      "config": { "colWidth": 12.0, "enabled": true, "results": {}, "editorSetting": { "language": "md" } }
    },
    {
      "text": "%script\nDROP TABLE agent_memory PURGE;\nDROP FUNCTION store_experience;\nDROP FUNCTION find_relevant_experience;\n\n-- Note: The ONNX model can be kept for other uses or dropped with:\n-- BEGIN DBMS_DATA_MINING.DROP_MODEL('ALL_MINILM_L12_V2'); END;\n-- /",
      "config": { "colWidth": 12.0, "enabled": true, "results": {}, "editorSetting": { "language": "sql" } }
    },
    {
      "text": "%md\n## Learn More\n\n* [AI Vector Search Guide](https://docs.oracle.com/en/database/oracle/oracle-database/26/vecse/)\n\n## Acknowledgements\n\n* **Author** - David Start\n* **Last Updated By/Date** - David Start, January 2026",
      "config": { "colWidth": 12.0, "enabled": true, "results": {}, "editorSetting": { "language": "md" } }
    }
  ],
  "name": "Lab 9 - Learning Loop",
  "id": "lab9-learning-loop",
  "noteParams": {},
  "noteForms": {},
  "angularObjects": {},
  "config": { "isZeppelinNotebookCronEnable": false },
  "info": {}
}