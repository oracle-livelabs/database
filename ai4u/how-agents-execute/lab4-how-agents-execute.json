{
  "paragraphs": [
    {
      "text": "%md\n## Watch an Agent Think and Act at Seer Equity\n\n### The Business Problem\n\nSeer Equity's loan officers are drowning in routine decisions. A $25,000 personal loan for someone with excellent credit should take minutes, not hours. But without smart routing, every application goes through the same manual review process.\n\n*\"Small loans take as long to process as big ones. We spend hours reviewing applications that should just auto-approve.\"*\n\nMeanwhile, the high-risk applications that actually need scrutiny get the same attention as routine ones. Senior underwriters waste time on $30K personal loans while $500K mortgages wait in queue.\n\n### What You'll Learn\n\nIn this lab, you'll build Seer Equity's risk assessment workflow. The agent will:\n\n1. Create loan applications with proper tracking IDs\n2. Assess risk based on loan type and amount\n3. Route appropriately:\n   - **Under $50K personal/auto** → Auto-approve (low risk)\n   - **$50K-$250K** → Underwriter review\n   - **Over $250K or mortgages** → Senior underwriter\n4. Log every step for audit compliance\n\nEvery agent follows the same pattern: **understand → plan → execute tools → analyze results → respond**. You'll trace this loop with detailed logging.\n\n**What you'll build:** A loan risk assessment workflow with conditional routing and audit trail.\n\n**Estimated Time:** 10 minutes",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "md"
        },
        "editorHide": true
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<h2>Watch an Agent Think and Act at Seer Equity</h2>\n\n<h3>The Business Problem</h3>\n\n<p>Seer Equity's loan officers are drowning in routine decisions. A $25,000 personal loan for someone with excellent credit should take minutes, not hours. But without smart routing, every application goes through the same manual review process.</p>\n\n<p><em>\"Small loans take as long to process as big ones. We spend hours reviewing applications that should just auto-approve.\"</em></p>\n\n<p>Meanwhile, the high-risk applications that actually need scrutiny get the same attention as routine ones. Senior underwriters waste time on $30K personal loans while $500K mortgages wait in queue.</p>\n\n<h3>What You'll Learn</h3>\n\n<p>In this lab, you'll build Seer Equity's risk assessment workflow. The agent will:</p>\n\n<ol>\n<li>Create loan applications with proper tracking IDs</li>\n<li>Assess risk based on loan type and amount</li>\n<li>Route appropriately:\n<ul>\n<li><strong>Under $50K personal/auto</strong> → Auto-approve (low risk)</li>\n<li><strong>$50K-$250K</strong> → Underwriter review</li>\n<li><strong>Over $250K or mortgages</strong> → Senior underwriter</li>\n</ul></li>\n<li>Log every step for audit compliance</li>\n</ol>\n\n<p>Every agent follows the same pattern: <strong>understand → plan → execute tools → analyze results → respond</strong>. You'll trace this loop with detailed logging.</p>\n\n<p><strong>What you'll build:</strong> A loan risk assessment workflow with conditional routing and audit trail.</p>\n\n<p><strong>Estimated Time:</strong> 10 minutes</p>"
          }
        ]
      }
    },
    {
      "text": "%md\n## Create the Tracking Infrastructure\n\nYou'll create tables that log every step the agent takes. This lets you watch the execution unfold like a movie. This is critical for audit trails in financial services.\n\nThe `workflow_log` table captures each step as it happens. The `loan_applications` table holds the actual business data the agent creates.",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "md"
        },
        "editorHide": true
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<h2>Create the Tracking Infrastructure</h2>\n\n<p>You'll create tables that log every step the agent takes. This lets you watch the execution unfold like a movie. This is critical for audit trails in financial services.</p>\n\n<p>The <code>workflow_log</code> table captures each step as it happens. The <code>loan_applications</code> table holds the actual business data the agent creates.</p>"
          }
        ]
      }
    },
    {
      "text": "%script\nCREATE SEQUENCE loan_applications_seq START WITH 1001;\n\nCREATE TABLE workflow_log (\n    log_id      NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,\n    step_name   VARCHAR2(100),\n    step_detail VARCHAR2(500),\n    logged_at   TIMESTAMP DEFAULT SYSTIMESTAMP\n);\n\nCREATE TABLE loan_applications (\n    application_id  VARCHAR2(20) PRIMARY KEY,\n    applicant_name  VARCHAR2(100),\n    loan_amount     NUMBER(12,2),\n    loan_type       VARCHAR2(50),\n    risk_status     VARCHAR2(30) DEFAULT 'NEW',\n    created_at      TIMESTAMP DEFAULT SYSTIMESTAMP\n);",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "sql"
        }
      }
    },
    {
      "text": "%md\n## Create the Loan Application Tool\n\nThis function creates loan applications. Notice it logs to `workflow_log` before doing its work—this is how you'll trace execution.\n\nThe function generates a unique ID like `LOAN-250108-1001` and inserts the application with status `SUBMITTED`.",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "md"
        },
        "editorHide": true
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<h2>Create the Loan Application Tool</h2>\n\n<p>This function creates loan applications. Notice it logs to <code>workflow_log</code> before doing its work—this is how you'll trace execution.</p>\n\n<p>The function generates a unique ID like <code>LOAN-250108-1001</code> and inserts the application with status <code>SUBMITTED</code>.</p>"
          }
        ]
      }
    },
    {
      "text": "%script\nCREATE OR REPLACE FUNCTION create_loan_application(\n    p_applicant  VARCHAR2,\n    p_amount     NUMBER,\n    p_loan_type  VARCHAR2\n) RETURN VARCHAR2 AS\n    PRAGMA AUTONOMOUS_TRANSACTION;\n    v_application_id VARCHAR2(20);\nBEGIN\n    v_application_id := 'LOAN-' || TO_CHAR(SYSDATE, 'YYMMDD') || '-' || loan_applications_seq.NEXTVAL;\n    \n    -- Log the step\n    INSERT INTO workflow_log (step_name, step_detail) \n    VALUES ('CREATE_APPLICATION', 'Created ' || v_application_id || ' for ' || p_applicant || ', $' || TO_CHAR(p_amount, '999,999'));\n    \n    -- Create the application\n    INSERT INTO loan_applications (application_id, applicant_name, loan_amount, loan_type, risk_status)\n    VALUES (v_application_id, p_applicant, p_amount, p_loan_type, 'SUBMITTED');\n    \n    COMMIT;\n    RETURN 'Created loan application ' || v_application_id || ' for $' || TO_CHAR(p_amount, '999,999') || ' (' || p_loan_type || ' loan)';\nEND;\n/",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "sql"
        }
      }
    },
    {
      "text": "%md\n## Create the Risk Assessment Tool\n\nThis function determines what risk level applies based on loan amount and type. At Seer Equity:\n\n- Personal loans under $50K → **AUTO_APPROVE** (low risk, standard terms)\n- Personal/Auto loans $50K-$250K → **UNDERWRITER_REVIEW** (moderate risk)\n- Any loan $250K+ OR all Mortgage loans → **SENIOR_UNDERWRITER** (high value/complexity)\n\nThe agent will use this result to decide whether to route for human review.",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "md"
        },
        "editorHide": true
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<h2>Create the Risk Assessment Tool</h2>\n\n<p>This function determines what risk level applies based on loan amount and type. At Seer Equity:</p>\n\n<ul>\n<li>Personal loans under $50K → <strong>AUTO_APPROVE</strong> (low risk, standard terms)</li>\n<li>Personal/Auto loans $50K-$250K → <strong>UNDERWRITER_REVIEW</strong> (moderate risk)</li>\n<li>Any loan $250K+ OR all Mortgage loans → <strong>SENIOR_UNDERWRITER</strong> (high value/complexity)</li>\n</ul>\n\n<p>The agent will use this result to decide whether to route for human review.</p>"
          }
        ]
      }
    },
    {
      "text": "%script\nCREATE OR REPLACE FUNCTION assess_loan_risk(\n    p_amount    NUMBER,\n    p_loan_type VARCHAR2\n) RETURN VARCHAR2 AS\n    PRAGMA AUTONOMOUS_TRANSACTION;\n    v_result VARCHAR2(200);\nBEGIN\n    -- Log the step\n    INSERT INTO workflow_log (step_name, step_detail) \n    VALUES ('ASSESS_RISK', 'Assessing risk for $' || TO_CHAR(p_amount, '999,999') || ' ' || p_loan_type || ' loan');\n    \n    -- Apply Seer Equity risk rules\n    IF UPPER(p_loan_type) = 'MORTGAGE' THEN\n        v_result := 'SENIOR_UNDERWRITER: All mortgage loans require senior review';\n    ELSIF p_amount >= 250000 THEN\n        v_result := 'SENIOR_UNDERWRITER: Loans $250K+ require senior underwriter';\n    ELSIF p_amount >= 50000 THEN\n        v_result := 'UNDERWRITER_REVIEW: Loans $50K-$250K require underwriter review';\n    ELSE\n        v_result := 'AUTO_APPROVE: Personal loans under $50K auto-approved';\n    END IF;\n    \n    COMMIT;\n    RETURN v_result;\nEND;\n/",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "sql"
        }
      }
    },
    {
      "text": "%md\n## Create the Routing Tool\n\nThis function routes loan applications for underwriting review by updating their status. The agent should only call this when the risk assessment returns UNDERWRITER_REVIEW or SENIOR_UNDERWRITER.\n\nThis is where you'll see the agent make decisions. It reads the risk assessment and decides whether to call this tool.",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "md"
        },
        "editorHide": true
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<h2>Create the Routing Tool</h2>\n\n<p>This function routes loan applications for underwriting review by updating their status. The agent should only call this when the risk assessment returns UNDERWRITER_REVIEW or SENIOR_UNDERWRITER.</p>\n\n<p>This is where you'll see the agent make decisions. It reads the risk assessment and decides whether to call this tool.</p>"
          }
        ]
      }
    },
    {
      "text": "%script\nCREATE OR REPLACE FUNCTION route_for_underwriting(\n    p_application_id  VARCHAR2,\n    p_review_level    VARCHAR2\n) RETURN VARCHAR2 AS\n    PRAGMA AUTONOMOUS_TRANSACTION;\nBEGIN\n    -- Log the step\n    INSERT INTO workflow_log (step_name, step_detail) \n    VALUES ('ROUTE_UNDERWRITING', 'Routing ' || p_application_id || ' for ' || p_review_level);\n    \n    -- Update status\n    UPDATE loan_applications \n    SET risk_status = 'PENDING_' || p_review_level\n    WHERE application_id = p_application_id;\n    \n    COMMIT;\n    RETURN 'Routed ' || p_application_id || ' for ' || p_review_level || ' review';\nEND;\n/",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "sql"
        }
      }
    },
    {
      "text": "%md\n## Register the Tools with the Agent Framework\n\nEach tool has an `instruction` that tells the agent when and how to use it. Notice the instruction for ROUTE_UNDERWRITING_TOOL says \"Only call this if ASSESS_RISK_TOOL returned UNDERWRITER_REVIEW or SENIOR_UNDERWRITER.\"\n\nThis is how you guide agent behavior: through clear instructions in tool definitions.",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "md"
        },
        "editorHide": true
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<h2>Register the Tools with the Agent Framework</h2>\n\n<p>Each tool has an <code>instruction</code> that tells the agent when and how to use it. Notice the instruction for ROUTE_UNDERWRITING_TOOL says \"Only call this if ASSESS_RISK_TOOL returned UNDERWRITER_REVIEW or SENIOR_UNDERWRITER.\"</p>\n\n<p>This is how you guide agent behavior: through clear instructions in tool definitions.</p>"
          }
        ]
      }
    },
    {
      "text": "%script\nBEGIN\n    DBMS_CLOUD_AI_AGENT.CREATE_TOOL(\n        tool_name   => 'CREATE_LOAN_TOOL',\n        attributes  => '{\"instruction\": \"Create a new loan application at Seer Equity. Parameters: P_APPLICANT (applicant name), P_AMOUNT (loan amount as number), P_LOAN_TYPE (personal, auto, mortgage, or business). Returns the application ID.\",\n                        \"function\": \"create_loan_application\"}',\n        description => 'Creates a loan application and returns the application ID'\n    );\n    \n    DBMS_CLOUD_AI_AGENT.CREATE_TOOL(\n        tool_name   => 'ASSESS_RISK_TOOL',\n        attributes  => '{\"instruction\": \"Assess risk level for a loan application. Parameters: P_AMOUNT (loan amount as number), P_LOAN_TYPE (personal, auto, mortgage, or business). Returns AUTO_APPROVE, UNDERWRITER_REVIEW, or SENIOR_UNDERWRITER.\",\n                        \"function\": \"assess_loan_risk\"}',\n        description => 'Returns the required review level based on amount and loan type'\n    );\n    \n    DBMS_CLOUD_AI_AGENT.CREATE_TOOL(\n        tool_name   => 'ROUTE_UNDERWRITING_TOOL',\n        attributes  => '{\"instruction\": \"Route a loan application for underwriting review. Only call this if ASSESS_RISK_TOOL returned UNDERWRITER_REVIEW or SENIOR_UNDERWRITER. Do NOT call this for AUTO_APPROVE. Parameters: P_APPLICATION_ID (the LOAN-YYMMDD-NNNN format ID), P_REVIEW_LEVEL (UNDERWRITER or SENIOR_UNDERWRITER).\",\n                        \"function\": \"route_for_underwriting\"}',\n        description => 'Routes the loan application to the appropriate underwriter'\n    );\nEND;\n/",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "sql"
        }
      }
    },
    {
      "text": "%md\n## Create the Agent and Team\n\nThe agent's role tells it the sequence: create → assess risk → route (if needed). The task instruction reinforces this and specifically says NOT to route if risk assessment says AUTO_APPROVE.\n\nThis combination of role + task instruction shapes how the agent plans its work at Seer Equity.",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "md"
        },
        "editorHide": true
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<h2>Create the Agent and Team</h2>\n\n<p>The agent's role tells it the sequence: create → assess risk → route (if needed). The task instruction reinforces this and specifically says NOT to route if risk assessment says AUTO_APPROVE.</p>\n\n<p>This combination of role + task instruction shapes how the agent plans its work at Seer Equity.</p>"
          }
        ]
      }
    },
    {
      "text": "%script\nBEGIN\n    DBMS_CLOUD_AI_AGENT.CREATE_AGENT(\n        agent_name  => 'LOAN_EXEC_AGENT',\n        attributes  => '{\"profile_name\": \"genai\",\n                        \"role\": \"You are a loan processing agent for Seer Equity. Process loan applications by: 1) Creating the application, 2) Assessing the risk, 3) Only routing for underwriting if risk assessment requires it. If assessment says AUTO_APPROVE, do not route.\"}',\n        description => 'Agent demonstrating loan processing execution loop'\n    );\n    \n    DBMS_CLOUD_AI_AGENT.CREATE_TASK(\n        task_name   => 'LOAN_EXEC_TASK',\n        attributes  => '{\"instruction\": \"Process the loan application: 1. Call CREATE_LOAN_TOOL to create the application 2. Call ASSESS_RISK_TOOL to determine risk level 3. If result contains UNDERWRITER_REVIEW or SENIOR_UNDERWRITER, call ROUTE_UNDERWRITING_TOOL. If result is AUTO_APPROVE, do NOT call ROUTE_UNDERWRITING_TOOL - just confirm the loan is auto-approved. User request: {query}\",\n                        \"tools\": [\"CREATE_LOAN_TOOL\", \"ASSESS_RISK_TOOL\", \"ROUTE_UNDERWRITING_TOOL\"]}',\n        description => 'Task for loan execution demo'\n    );\n    \n    DBMS_CLOUD_AI_AGENT.CREATE_TEAM(\n        team_name   => 'LOAN_EXEC_TEAM',\n        attributes  => '{\"agents\": [{\"name\": \"LOAN_EXEC_AGENT\", \"task\": \"LOAN_EXEC_TASK\"}],\n                        \"process\": \"sequential\"}',\n        description => 'Team for loan execution demo'\n    );\nEND;\n/",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "sql"
        }
      }
    },
    {
      "text": "%md\n## Clear the Log and Activate the Team\n\nBefore running a test, clear the workflow log so you see only the steps from this execution. Then set the team so your SELECT AI AGENT commands go to this agent.",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "md"
        },
        "editorHide": true
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<h2>Clear the Log and Activate the Team</h2>\n\n<p>Before running a test, clear the workflow log so you see only the steps from this execution. Then set the team so your SELECT AI AGENT commands go to this agent.</p>"
          }
        ]
      }
    },
    {
      "text": "%script\nTRUNCATE TABLE workflow_log;\nEXEC DBMS_CLOUD_AI_AGENT.SET_TEAM('LOAN_EXEC_TEAM');",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "sql"
        }
      }
    },
    {
      "text": "%md\n## Submit a $75,000 Auto Loan (Underwriter Review Path)\n\nThis $75,000 auto loan should trigger the full workflow:\n1. Create the loan application\n2. Assess risk → returns UNDERWRITER_REVIEW (between $50K and $250K)\n3. Route for underwriter review\n\nWatch the agent's response—it should mention creating the application and routing it for underwriter review.",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "md"
        },
        "editorHide": true
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<h2>Submit a $75,000 Auto Loan (Underwriter Review Path)</h2>\n\n<p>This $75,000 auto loan should trigger the full workflow:</p>\n<ol>\n<li>Create the loan application</li>\n<li>Assess risk → returns UNDERWRITER_REVIEW (between $50K and $250K)</li>\n<li>Route for underwriter review</li>\n</ol>\n\n<p>Watch the agent's response—it should mention creating the application and routing it for underwriter review.</p>"
          }
        ]
      }
    },
    {
      "text": "%script\nSELECT AI AGENT Submit a $75000 auto loan application for John Smith;",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "sql"
        }
      }
    },
    {
      "text": "%md\n## Examine the Workflow Log\n\nNow look at exactly what happened, step by step. You should see three entries:\n\n1. **CREATE_APPLICATION**: The loan application was created with a unique ID\n2. **ASSESS_RISK**: Risk was evaluated ($75K auto loan requires underwriter)\n3. **ROUTE_UNDERWRITING**: It was routed for underwriter review\n\nThis is the execution trace, proof of what the agent actually did.",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "md"
        },
        "editorHide": true
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<h2>Examine the Workflow Log</h2>\n\n<p>Now look at exactly what happened, step by step. You should see three entries:</p>\n\n<ol>\n<li><strong>CREATE_APPLICATION</strong>: The loan application was created with a unique ID</li>\n<li><strong>ASSESS_RISK</strong>: Risk was evaluated ($75K auto loan requires underwriter)</li>\n<li><strong>ROUTE_UNDERWRITING</strong>: It was routed for underwriter review</li>\n</ol>\n\n<p>This is the execution trace, proof of what the agent actually did.</p>"
          }
        ]
      }
    },
    {
      "text": "%script\nSELECT \n    step_name,\n    step_detail,\n    TO_CHAR(logged_at, 'HH24:MI:SS.FF3') as time\nFROM workflow_log\nORDER BY log_id;",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "sql"
        }
      }
    },
    {
      "text": "%md\n## Check the Tool Execution History\n\nOracle also maintains its own history of tool calls. This shows you the inputs and outputs of each tool.\n\nYou should see CREATE_LOAN_TOOL, ASSESS_RISK_TOOL, and ROUTE_UNDERWRITING_TOOL in sequence.",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "md"
        },
        "editorHide": true
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<h2>Check the Tool Execution History</h2>\n\n<p>Oracle also maintains its own history of tool calls. This shows you the inputs and outputs of each tool.</p>\n\n<p>You should see CREATE_LOAN_TOOL, ASSESS_RISK_TOOL, and ROUTE_UNDERWRITING_TOOL in sequence.</p>"
          }
        ]
      }
    },
    {
      "text": "%script\nSELECT \n    tool_name,\n    TO_CHAR(start_date, 'HH24:MI:SS.FF3') as started,\n    TO_CHAR(end_date, 'HH24:MI:SS.FF3') as ended,\n    SUBSTR(output, 1, 60) as result\nFROM USER_AI_AGENT_TOOL_HISTORY\nORDER BY start_date DESC\nFETCH FIRST 10 ROWS ONLY;",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "sql"
        }
      }
    },
    {
      "text": "%md\n## Verify the Loan Application Record\n\nLook at the actual database record. You should see John Smith's $75,000 auto loan with status **PENDING_UNDERWRITER**.\n\nThis proves the agent didn't just say it routed the loan—it actually updated the database.",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "md"
        },
        "editorHide": true
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<h2>Verify the Loan Application Record</h2>\n\n<p>Look at the actual database record. You should see John Smith's $75,000 auto loan with status <strong>PENDING_UNDERWRITER</strong>.</p>\n\n<p>This proves the agent didn't just say it routed the loan—it actually updated the database.</p>"
          }
        ]
      }
    },
    {
      "text": "%script\nSELECT \n    application_id,\n    applicant_name,\n    TO_CHAR(loan_amount, '$999,999') as loan_amount,\n    loan_type,\n    risk_status,\n    TO_CHAR(created_at, 'HH24:MI:SS') as created\nFROM loan_applications\nORDER BY created_at DESC;",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "sql"
        }
      }
    },
    {
      "text": "%md\n## Submit a $25,000 Personal Loan (Auto-Approve Path)\n\nNow try a small personal loan that should be auto-approved. Clear the log first so you see only this execution.\n\nWith $25,000, the risk assessment should return AUTO_APPROVE, and the agent should NOT call ROUTE_UNDERWRITING_TOOL.",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "md"
        },
        "editorHide": true
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<h2>Submit a $25,000 Personal Loan (Auto-Approve Path)</h2>\n\n<p>Now try a small personal loan that should be auto-approved. Clear the log first so you see only this execution.</p>\n\n<p>With $25,000, the risk assessment should return AUTO_APPROVE, and the agent should NOT call ROUTE_UNDERWRITING_TOOL.</p>"
          }
        ]
      }
    },
    {
      "text": "%script\nTRUNCATE TABLE workflow_log;\nSELECT AI AGENT Submit a $25000 personal loan application for Jane Doe;",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "sql"
        }
      }
    },
    {
      "text": "%md\n## Check the Workflow Log for Auto-Approve\n\nYou should see only TWO steps this time:\n\n1. **CREATE_APPLICATION**: The loan application was created\n2. **ASSESS_RISK**: Risk assessment returned AUTO_APPROVE\n\nNo ROUTE_UNDERWRITING step! The agent correctly decided not to route because the risk assessment said AUTO_APPROVE. This is the agent making a decision based on data.",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "md"
        },
        "editorHide": true
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<h2>Check the Workflow Log for Auto-Approve</h2>\n\n<p>You should see only TWO steps this time:</p>\n\n<ol>\n<li><strong>CREATE_APPLICATION</strong>: The loan application was created</li>\n<li><strong>ASSESS_RISK</strong>: Risk assessment returned AUTO_APPROVE</li>\n</ol>\n\n<p>No ROUTE_UNDERWRITING step! The agent correctly decided not to route because the risk assessment said AUTO_APPROVE. This is the agent making a decision based on data.</p>"
          }
        ]
      }
    },
    {
      "text": "%script\nSELECT step_name, step_detail FROM workflow_log ORDER BY log_id;",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "sql"
        }
      }
    },
    {
      "text": "%md\n## Verify the Auto-Approved Loan\n\nJane's loan should have status **SUBMITTED** (not PENDING_UNDERWRITER), because it was auto-approved and didn't need routing.",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "md"
        },
        "editorHide": true
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<h2>Verify the Auto-Approved Loan</h2>\n\n<p>Jane's loan should have status <strong>SUBMITTED</strong> (not PENDING_UNDERWRITER), because it was auto-approved and didn't need routing.</p>"
          }
        ]
      }
    },
    {
      "text": "%script\nSELECT application_id, applicant_name, TO_CHAR(loan_amount, '$999,999') as amount, risk_status \nFROM loan_applications \nWHERE applicant_name = 'Jane Doe';",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "sql"
        }
      }
    },
    {
      "text": "%md\n## Submit a $350,000 Mortgage (Senior Underwriter Path)\n\nOne more test: a mortgage application that requires senior underwriter review. Mortgages at Seer Equity always require senior review regardless of amount.",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "md"
        },
        "editorHide": true
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<h2>Submit a $350,000 Mortgage (Senior Underwriter Path)</h2>\n\n<p>One more test: a mortgage application that requires senior underwriter review. Mortgages at Seer Equity always require senior review regardless of amount.</p>"
          }
        ]
      }
    },
    {
      "text": "%script\nTRUNCATE TABLE workflow_log;\nSELECT AI AGENT Submit a $350000 mortgage loan application for Bob Wilson;",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "sql"
        }
      }
    },
    {
      "text": "%md\n## Check the Senior Underwriter Path\n\nYou should see all THREE steps again, but this time ROUTE_UNDERWRITING shows SENIOR_UNDERWRITER instead of UNDERWRITER.",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "md"
        },
        "editorHide": true
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<h2>Check the Senior Underwriter Path</h2>\n\n<p>You should see all THREE steps again, but this time ROUTE_UNDERWRITING shows SENIOR_UNDERWRITER instead of UNDERWRITER.</p>"
          }
        ]
      }
    },
    {
      "text": "%script\nSELECT step_name, step_detail FROM workflow_log ORDER BY log_id;",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "sql"
        }
      }
    },
    {
      "text": "%md\n## Verify Bob's Mortgage Status\n\nBob's mortgage should have status **PENDING_SENIOR_UNDERWRITER**. The agent correctly routed it to the higher review level.",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "md"
        },
        "editorHide": true
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<h2>Verify Bob's Mortgage Status</h2>\n\n<p>Bob's mortgage should have status <strong>PENDING_SENIOR_UNDERWRITER</strong>. The agent correctly routed it to the higher review level.</p>"
          }
        ]
      }
    },
    {
      "text": "%script\nSELECT application_id, applicant_name, TO_CHAR(loan_amount, '$999,999') as amount, loan_type, risk_status \nFROM loan_applications \nWHERE applicant_name = 'Bob Wilson';",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "sql"
        }
      }
    },
    {
      "text": "%md\n## Compare All Three Execution Paths\n\nLet's see all loan applications side by side. Notice how different amounts and loan types led to different statuses:\n\n| Amount | Type | Status | Why |\n|--------|------|--------|-----|\n| $25,000 | Personal | SUBMITTED | Auto-approved, under $50K |\n| $75,000 | Auto | PENDING_UNDERWRITER | Between $50K-$250K |\n| $350,000 | Mortgage | PENDING_SENIOR_UNDERWRITER | Mortgages require senior review |\n\nSame agent, same tools, but different execution paths based on the data. That is exactly how Seer Equity manages loan risk.",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "md"
        },
        "editorHide": true
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<h2>Compare All Three Execution Paths</h2>\n\n<p>Let's see all loan applications side by side. Notice how different amounts and loan types led to different statuses:</p>\n\n<table border=\"1\" style=\"border-collapse: collapse;\">\n<tr><th style=\"padding: 8px;\">Amount</th><th style=\"padding: 8px;\">Type</th><th style=\"padding: 8px;\">Status</th><th style=\"padding: 8px;\">Why</th></tr>\n<tr><td style=\"padding: 8px;\">$25,000</td><td style=\"padding: 8px;\">Personal</td><td style=\"padding: 8px;\">SUBMITTED</td><td style=\"padding: 8px;\">Auto-approved, under $50K</td></tr>\n<tr><td style=\"padding: 8px;\">$75,000</td><td style=\"padding: 8px;\">Auto</td><td style=\"padding: 8px;\">PENDING_UNDERWRITER</td><td style=\"padding: 8px;\">Between $50K-$250K</td></tr>\n<tr><td style=\"padding: 8px;\">$350,000</td><td style=\"padding: 8px;\">Mortgage</td><td style=\"padding: 8px;\">PENDING_SENIOR_UNDERWRITER</td><td style=\"padding: 8px;\">Mortgages require senior review</td></tr>\n</table>\n\n<p>Same agent, same tools, but different execution paths based on the data. That is exactly how Seer Equity manages loan risk.</p>"
          }
        ]
      }
    },
    {
      "text": "%script\nSELECT \n    application_id,\n    applicant_name,\n    TO_CHAR(loan_amount, '$999,999') as loan_amount,\n    loan_type,\n    risk_status,\n    CASE \n        WHEN loan_amount < 50000 AND loan_type != 'mortgage' THEN 'Auto-approved'\n        WHEN loan_type = 'mortgage' THEN 'Senior underwriter (mortgage)'\n        WHEN loan_amount >= 250000 THEN 'Senior underwriter (high value)'\n        ELSE 'Standard underwriter review'\n    END as routing_reason\nFROM loan_applications\nORDER BY created_at;",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "sql"
        }
      }
    },
    {
      "text": "%md\n## The Execution Pattern\n\nEvery agent execution follows this pattern:\n\n1. **Receive request** → Loan officer submits application\n2. **LLM understands** → Interprets applicant, amount, loan type\n3. **LLM plans** → Determines which tools, in what order\n4. **Tool executes** → First tool runs, returns result\n5. **LLM analyzes** → Interprets the result, decides next step\n6. **Repeat** → More tools if needed (conditionally)\n7. **LLM responds** → Generates final response\n\nThe key insight: **step 5 is where decisions happen**. The agent reads the risk assessment and decides whether to route. This is what makes agents intelligent. They adapt based on data.",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "md"
        },
        "editorHide": true
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<h2>The Execution Pattern</h2>\n\n<p>Every agent execution follows this pattern:</p>\n\n<ol>\n<li><strong>Receive request</strong> → Loan officer submits application</li>\n<li><strong>LLM understands</strong> → Interprets applicant, amount, loan type</li>\n<li><strong>LLM plans</strong> → Determines which tools, in what order</li>\n<li><strong>Tool executes</strong> → First tool runs, returns result</li>\n<li><strong>LLM analyzes</strong> → Interprets the result, decides next step</li>\n<li><strong>Repeat</strong> → More tools if needed (conditionally)</li>\n<li><strong>LLM responds</strong> → Generates final response</li>\n</ol>\n\n<p>The key insight: <strong>step 5 is where decisions happen</strong>. The agent reads the risk assessment and decides whether to route. This is what makes agents intelligent. They adapt based on data.</p>"
          }
        ]
      }
    },
    {
      "text": "%md\n## What You Learned\n\nIn this lab, you traced the complete agent execution loop at Seer Equity:\n\n- **Logging**: Added workflow_log entries to see each step\n- **Conditional execution**: Agent called routing tool only when risk assessment required it\n- **Three paths**: Auto-approve, underwriter review, senior underwriter review\n- **Verification**: Checked both logs and actual database records\n\n**Key takeaway:** The agent orchestrates, the LLM thinks, the tools act. Every step is logged. Every action is traceable. This is what makes agents production-ready for financial services.",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "md"
        },
        "editorHide": true
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<h2>What You Learned</h2>\n\n<p>In this lab, you traced the complete agent execution loop at Seer Equity:</p>\n\n<ul>\n<li><strong>Logging</strong>: Added workflow_log entries to see each step</li>\n<li><strong>Conditional execution</strong>: Agent called routing tool only when risk assessment required it</li>\n<li><strong>Three paths</strong>: Auto-approve, underwriter review, senior underwriter review</li>\n<li><strong>Verification</strong>: Checked both logs and actual database records</li>\n</ul>\n\n<p><strong>Key takeaway:</strong> The agent orchestrates, the LLM thinks, the tools act. Every step is logged. Every action is traceable. This is what makes agents production-ready for financial services.</p>"
          }
        ]
      }
    },
    {
      "text": "%md\n## Cleanup (Optional)\n\nRun this to remove all objects created in this lab.",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "md"
        },
        "editorHide": true
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<h2>Cleanup (Optional)</h2>\n\n<p>Run this to remove all objects created in this lab.</p>"
          }
        ]
      }
    },
    {
      "text": "%script\nEXEC DBMS_CLOUD_AI_AGENT.DROP_TEAM('LOAN_EXEC_TEAM', TRUE);\nEXEC DBMS_CLOUD_AI_AGENT.DROP_TASK('LOAN_EXEC_TASK', TRUE);\nEXEC DBMS_CLOUD_AI_AGENT.DROP_AGENT('LOAN_EXEC_AGENT', TRUE);\nEXEC DBMS_CLOUD_AI_AGENT.DROP_TOOL('CREATE_LOAN_TOOL', TRUE);\nEXEC DBMS_CLOUD_AI_AGENT.DROP_TOOL('ASSESS_RISK_TOOL', TRUE);\nEXEC DBMS_CLOUD_AI_AGENT.DROP_TOOL('ROUTE_UNDERWRITING_TOOL', TRUE);\nDROP TABLE loan_applications PURGE;\nDROP TABLE workflow_log PURGE;\nDROP SEQUENCE loan_applications_seq;\nDROP FUNCTION create_loan_application;\nDROP FUNCTION assess_loan_risk;\nDROP FUNCTION route_for_underwriting;",
      "config": {
        "colWidth": 12.0,
        "enabled": true,
        "results": {},
        "editorSetting": {
          "language": "sql"
        }
      }
    }
  ],
  "name": "Lab 4 - How Agents Execute",
  "id": "lab4-how-agents-execute",
  "noteParams": {},
  "noteForms": {},
  "angularObjects": {},
  "config": {
    "isZeppelinNotebookCronEnable": false
  },
  "info": {}
}
